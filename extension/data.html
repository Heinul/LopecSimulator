<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>로펙 시뮬레이터 데이터 분석</title>
  <link rel="stylesheet" href="css/data.css">
</head>
<body>
  <div class="data-wrapper">
    <div class="header">
      <h1>로펙 시뮬레이터 점수 분석</h1>
      <p>스캔된 데이터를 분석하고 관리합니다.</p>
    </div>
    
    <div class="summary-section">
      <div id="summary-container">
        <!-- 요약 정보가 여기에 표시됩니다 -->
        <div class="loading-indicator">데이터 로딩 중...</div>
      </div>
    </div>
    
    <div class="filter-section">
      <h2>필터 및 정렬</h2>
      <form id="filter-form" class="filter-form">
        <div class="filter-group">
          <label>
            <input type="checkbox" id="filter-increase"> 
            점수 상승 항목만 보기
          </label>
        </div>
        <div class="filter-group">
          <label for="category-filter">카테고리:</label>
          <select id="category-filter">
            <option value="all">전체</option>
            <option value="armor">장비</option>
            <option value="gem">보석</option>
            <option value="accessory">장신구</option>
            <option value="engraving">각인</option>
            <option value="karma">카르마</option>
            <option value="avatar">아바타</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="sort-by">정렬:</label>
          <select id="sort-by">
            <option value="differenceDesc">점수 변동 높은순</option>
            <option value="differenceAsc">점수 변동 낮은순</option>
          </select>
        </div>
      </form>
    </div>
    
    <div class="data-table-section">
      <div id="data-table-container">
        <!-- 데이터 테이블이 여기에 표시됩니다 -->
        <div class="loading-indicator">데이터 로딩 중...</div>
      </div>
    </div>
    
    <div class="export-section">
      <h2>데이터 내보내기</h2>
      <div class="export-buttons">
        <button id="export-csv" class="export-button">CSV 내보내기</button>
      </div>
    </div>
  </div>
  
  <script src="js/data/data-manager.js"></script>
  <script src="js/data/ui-controller.js"></script>
  <script src="js/api/api-diagnostics.js"></script>
  <script src="js/data/main.js"></script>
  
  <script>
    // 페이지 로드 시 진단 도구 추가
    document.addEventListener('DOMContentLoaded', function() {
      // 진단 도구 모듈이 로드된 경우 UI 추가
      setTimeout(function() {
        if (window.LopecScanner && window.LopecScanner.API && window.LopecScanner.API.Diagnostics) {
          console.log('진단 도구 모듈 감지됨, UI 추가 시도 중...');
          window.LopecScanner.API.Diagnostics.addDiagnosticsToPage('.data-wrapper');
        } else {
          console.error('진단 도구 모듈이 로드되지 않았습니다.');
          
          // 진단 도구 모듈이 없는 경우 대체 UI 표시
          const dataWrapper = document.querySelector('.data-wrapper');
          const apiSettings = document.getElementById('lostark-api-settings');
          
          if (dataWrapper) {
            const troubleshootUI = document.createElement('div');
            troubleshootUI.id = 'api-troubleshoot-ui';
            troubleshootUI.style.padding = '15px';
            troubleshootUI.style.backgroundColor = '#f9f9f9';
            troubleshootUI.style.border = '1px solid #ddd';
            troubleshootUI.style.borderRadius = '5px';
            troubleshootUI.style.marginTop = '15px';
            troubleshootUI.style.marginBottom = '15px';
            
            troubleshootUI.innerHTML = `
              <h3 style="margin-top: 0;">API 문제 해결 도우미</h3>
              <p>진단 도구를 찾을 수 없습니다. 확장 프로그램을 다시 로드하거나 업데이트해주세요.</p>
              <div style="margin-top: 10px;">
                <button id="reload-extension" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                  확장 프로그램 다시 로드
                </button>
              </div>
            `;
            
            if (apiSettings) {
              apiSettings.after(troubleshootUI);
            } else {
              dataWrapper.insertBefore(troubleshootUI, dataWrapper.firstChild);
            }
            
            // 확장 프로그램 다시 로드 버튼 이벤트
            document.getElementById('reload-extension').addEventListener('click', function() {
              chrome.runtime.reload();
              location.reload();
            });
          }
        }
      }, 1000);
    });
  </script>
</body>
</html>
